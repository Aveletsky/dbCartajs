<html>
<head>
  <title>dbCartajs - HTML5 Canvas map - sample</title>
  <script type="text/javascript" src="../proj4js-combined.js"></script>
  <script type="text/javascript" src="../dbcarta.js"></script>
  <script type="text/javascript" src="demodata/continents.js"></script>
  <script type="text/javascript" src="demodata/loaddata.js"></script>
  <script type="text/javascript">
  function scale() {
    if ('dbcarta' in window) {
      var scale = parseFloat(document.getElementById("scale").value);
      dbcarta.scaleCarta(1); // fix labels
      dbcarta.scaleCarta(scale);
      dbcarta.draw();
    }
  }
  function trans() {
    if ('dbcarta' in window && dbcarta.isSpherical()) {
      var transx = parseFloat(document.getElementById("transx").value),
          transy = parseFloat(document.getElementById("transy").value);
      if (!isNaN(transx) && !isNaN(transy)) {
        dbcarta.initProj(dbcarta.project, transx, transy);
        dbcarta.draw();
      }
    }
  }
  function proj() {
    if ('dbcarta' in window) {
      dbcarta.changeProject(document.getElementById('proj').value);
      dbcarta.draw();
    }
  }
  function draw() {
    if ('dbcarta' in window) {
       try {coords = eval(document.getElementById('getcoords').value); coords.length; } 
       catch (e) { alert("Invalid coords!\nUse:\n[[1,2],[3,4],..]"); return; }
       dbcarta.loadCarta([[ document.getElementById("ftype").value, Math.random(), coords, 'MyTest' ]], 1);
    }
  }
  function init() {
    var el, el2, row, col, mtab;
    mtab = document.createElement("table");
    mtab.width = "100%";
    row = document.createElement("tr");
    mtab.appendChild(row);

    col = document.createElement("td");
    col.width = "15%";
    el = document.createElement("input");
    el.type = "text";
    el.size= "3";
    el.id = "scale";
    el.value= "1";
    col.appendChild(el);
    el = document.createElement('button');
    el.onclick = scale;
    el.appendChild(document.createTextNode("scale"));
    col.appendChild(el);
    row.appendChild(col);

    col = document.createElement("td");
    col.width = "15%";
    el = document.createElement("input");
    el.type = "text";
    el.size= "4";
    el.id = "transx";
    el.value= "10";
    col.appendChild(el);
    el = document.createElement("input");
    el.type = "text";
    el.size= "4";
    el.id = "transy";
    el.value= "10";
    col.appendChild(el);    
    el = document.createElement('button');
    el.onclick = trans;
    el.appendChild(document.createTextNode("trans"));
    col.appendChild(el);
    row.appendChild(col);

    col = document.createElement("td");
    col.width = "15%";
    el = document.createElement("select");
    el.id = "proj";
    var projlist = {0:'longlat', 101:'merc', 203:'ortho', 202:'nsper', 201:'laea'};
    for(var i in projlist) {
      el2 = document.createElement("option");
      el2.value = i;
      el2.appendChild(document.createTextNode(projlist[i]));
      el.appendChild(el2);  
    }
    col.appendChild(el);
    el = document.createElement('button');
    el.onclick = proj;
    el.appendChild(document.createTextNode("proj"));
    col.appendChild(el);
    row.appendChild(col);

    col = document.createElement("td");
    col.width = "35%";
    el = document.createElement("select");
    el.id = "ftype";
    el2 = document.createElement("option");
    el2.value = "Line";
    el2.appendChild(document.createTextNode(el2.value));
    el.appendChild(el2);
    el2 = document.createElement("option");
    el2.value = "Area";
    el2.appendChild(document.createTextNode(el2.value));
    el.appendChild(el2);      
    el2 = document.createElement("option");
    el2.value = "DotPort";
    el2.appendChild(document.createTextNode(el2.value));
    el.appendChild(el2);      
    col.appendChild(el);
    el = document.createElement("input");
    el.type = "text";
    el.id = "getcoords";
    col.appendChild(el);
    el = document.createElement('button');
    el.onclick = draw;
    el.appendChild(document.createTextNode("draw"));
    col.appendChild(el);
    row.appendChild(col);

    row.appendChild(col);
    col = document.createElement("td");
    col.id = "coords";
    col.align = "center";
    col.width = "20%";
    row.appendChild(col);

    document.body.appendChild(mtab);
    dbcarta = new dbCarta();
    loadConts();
    dbcarta.loadCarta([['DotPort', '1', [[-25,40]], 'Point 1']]);
    dbcarta.run();
    dbcarta.clfunc.onmousemove = function(v) {
      mcoord = document.getElementById("coords");
      mcoord.innerHTML = " X: Y:";
      if (v) mcoord.innerHTML = " X: " + v[0].toFixed(2) + " Y: " + v[1].toFixed(2);
    }
  }
  </script>
</head>
<body onload="init()"></body>
</html>